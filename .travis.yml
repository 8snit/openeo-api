language: python
python:
- "3.5"

sudo: required

before_install:
- pip install mkdocs
- pip install mkdocs-material
- pip install pymdown-extensions
- pip install pygments

install:
- mkdocs build --clean
- cp openapi.json site/
- rm site/apireference/index.html
- mv site/apireference.html site/apireference/index.html

script:
- git clone --branch gh-pages https://$GITHUB_TOKEN@github.com/Open-EO/openeo-api.git gh-pages
- cd gh-pages
- if [[ $TRAVIS_BRANCH == 'master' ]] ; then rm -rf !(v) && cp -R ../site/* ./ ; fi
- if [[ $TRAVIS_BRANCH != 'master' ]] ; then rm -rf v/$TRAVIS_BRANCH/ && mkdir -p v/$TRAVIS_BRANCH/ && cp -R ../site/* v/$TRAVIS_BRANCH/ ; fi

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN
  keep-history: true
  committer-from-gh: true
  local-dir: gh-pages
  on:
    all_branches: true